generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  client
  freelancer
  admin
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         Role     @default(client)
  avatar       String?
  city_id      Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  city               City?                @relation(fields: [city_id], references: [id])
  job_posts          JobPost[]            @relation("BuyerJobPosts")
  job_applications   JobApplication[]     @relation("FreelancerApplications")
  freelancerProfile  FreelancerProfile?   @relation("FreelancerProfileRelation")
  clientProfile      ClientProfile?       @relation("ClientProfileRelation")
  gigs               Gig[]                // from main branch
}

model Gig {
  id               Int      @id @default(autoincrement())
  gigTitle         String
  category         String
  shortDescription String
  thumbnailImage   String?
  galleryImages    String[]
  price            Float
  deliveryTime     Int
  revisions        Int
  additionalNotes  String?
  createdAt        DateTime @default(now())
  createdBy        String?
  user             User?    @relation(fields: [createdBy], references: [id])
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String
  slug        String   @unique
  description String?
  image       String?
  status      String   @default("active")
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  job_posts   JobPost[]
  specialties Specialty[]

  @@map("categories")
}

model City {
  id         Int      @id @default(autoincrement())
  name       String
  country    String?
  status     String   @default("active")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  job_posts JobPost[]
  users     User[]

  @@unique([name, country])
  @@map("cities")
}

model Skill {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  category   String
  type       String   @default("skill")
  status     String   @default("active")
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("skills")
}

model Specialty {
  id          Int      @id @default(autoincrement())
  name        String
  category_id Int
  status      String   @default("active")
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  category Category @relation(fields: [category_id], references: [id])

  @@unique([name, category_id])
  @@map("specialties")
}

model JobPost {
  id           Int     @id @default(autoincrement())
  title        String
  slug         String  @unique
  summary      String? @db.Text
  description  String  @db.Text
  deliverables String? @db.Text
  category_id  Int
  specialty    String?
  city_id      Int?

  budget_type      String   @default("hourly")
  hourly_rate_from Decimal? @db.Decimal(10, 2)
  hourly_rate_to   Decimal? @db.Decimal(10, 2)
  fixed_price      Decimal? @db.Decimal(10, 2)

  project_type       String  @default("one-time")
  duration           String?
  hours_per_week     String?
  job_size           String?
  freelancers_needed Int     @default(1)
  experience_level   String  @default("intermediate")

  mandatory_skills    Json?
  nice_to_have_skills Json?
  tools               Json?
  languages           Json?

  regular_price Decimal? @db.Decimal(10, 2)
  job_type      String   @default("Hourly")
  thumb_image   String?

  buyer_id          String
  status            String   @default("active")
  approved_by_admin String   @default("pending")
  featured          Boolean  @default(false)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt

  category     Category         @relation(fields: [category_id], references: [id])
  city         City?            @relation(fields: [city_id], references: [id])
  buyer        User             @relation("BuyerJobPosts", fields: [buyer_id], references: [id])
  applications JobApplication[]

  @@map("job_posts")
}

model JobApplication {
  id             Int      @id @default(autoincrement())
  job_post_id    Int
  freelancer_id  String
  cover_letter   String   @db.Text
  proposed_price Decimal  @db.Decimal(10, 2)
  delivery_time  Int
  status         String   @default("pending")
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  job_post   JobPost @relation(fields: [job_post_id], references: [id], onDelete: Cascade)
  freelancer User    @relation("FreelancerApplications", fields: [freelancer_id], references: [id])

  @@unique([job_post_id, freelancer_id])
  @@map("job_applications")
}

model FreelancerProfile {
  id                   Int      @id @default(autoincrement())
  user_id              String   @unique
  title                String?
  bio                  String?   @db.Text
  phone                String?
  date_of_birth        DateTime?
  gender               String?
  address              String?
  city                 String?
  state                String?
  country              String?
  postal_code          String?
  specialization       String?
  hourly_rate          Decimal?  @db.Decimal(10, 2)
  years_of_experience  Int       @default(0)
  skills               Json?
  languages            Json?
  education            Json?
  experience           Json?
  certifications       Json?
  portfolio_items      Json?
  linkedin_url         String?
  github_url           String?
  website_url          String?
  twitter_url          String?
  bank_accounts        Json?
  payment_methods      Json?
  profile_image        String?
  cover_image          String?
  is_available         Boolean   @default(true)
  created_at           DateTime  @default(now())
  updated_at           DateTime  @updatedAt

  user User @relation("FreelancerProfileRelation", fields: [user_id], references: [id], onDelete: Cascade)

  @@map("freelancer_profiles")
}

model ClientProfile {
  id                Int      @id @default(autoincrement())
  user_id           String   @unique
  phone             String?
  date_of_birth     DateTime?
  gender            String?
  company_name      String?
  company_size      String?
  industry          String?
  address           String?
  city              String?
  state             String?
  country           String?
  postal_code       String?
  website_url       String?
  linkedin_url      String?
  education         Json?
  certifications    Json?
  bank_accounts     Json?
  payment_methods   Json?
  profile_image     String?
  preferred_language String? @default("en")
  timezone          String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  user User @relation("ClientProfileRelation", fields: [user_id], references: [id], onDelete: Cascade)

  @@map("client_profiles")
}
